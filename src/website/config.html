<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyecto Horticultura</title>
</head>

<body>
    <h1>Proyecto Horticultura</h1>
    <h2>Hora</h2>
    <form action="/hora" method="post">
        <label>Hora:</label>
        <input type="time" id="hora" name="hora" value="00:00">
        <br><br>
        <input type="submit" value="Actualizar">

    </form>
    <h2>Red</h2>
    <span><strong>Nombre de la Red:</strong> </span><span id="ID"></span>
    <br>
    <span><strong>Contraseña de la Red:</strong> </span><span id="PASS"></span>
    <br><br>
    <form action="/red" method="post">
        <label for="Nombre">Nuevo Nombre:</label>
        <input type="text" id="nombre" name="nombre" placeholder="Nuevo Nombre de Red">
        <br><br>
        <label for="Contraseña">Nueva Contraseña:</label>
        <input type="text" id="Contrasenia" name="Contrasenia" placeholder="Nueva contraseña">
        <br><br>
        <input type="submit" value="Actualizar">

    </form>

    <h2>Potencia de luz</h2>

    <form action="/pwm" method="post">
        <label for="rango" class="range-label">Intensidad (0%-100%):</label>
        <input type="range" id="rango" name="rango" min="0" max="100" value="0" onchange="updateRangoValue()" disabled>
        <span id="rangoValor">0</span>
        <br>

        <label>Modo:</label>
        <select id="modos_pwm" name="modos_pwm" onchange="habilitarHorario();DeshabilitarRango();">
            <option value="Manual">Manual</option>
            <option value="Automatico">Automatico</option>
            <option value="OFF" selected>Apagado</option>
        </select><br>

        <label>Encendido:</label>
        <input type="time" id="ih_pwm" name="ih_pwm" value="00:00" disabled>
        <br>
        <label>Apagado:</label>
        <input type="time" id="fh_pwm" name="fh_pwm" value="00:00" disabled><br>

        <label>Amanecer / Atardecer:</label>
        <select id="opciones" name="Opciones">
            <option value="Si">SI</option>
            <option value="No">NO</option>
        </select><br>

        <input type="submit" value="Actualizar">

    </form>
    <h2>Control 220V</h2>
    <form action="/triac" method="post">
        <label>Modo:</label>
        <select id="modos_triac" name="modos_triac" onchange="statusCheckboxs();toggleHorario('ih1', 'fh1', 'checkboxh1');
        toggleHorario('ih2', 'fh2', 'checkboxh2');
        toggleHorario('ih3', 'fh3', 'checkboxh3');
        toggleHorario('ih4', 'fh4', 'checkboxh4');">
            <option value="Encendido">ACTIVAR</option>
            <option value="Automatico">AUTO</option>
            <option value="Apagado" selected>NO</option>
        </select><br>
        <label>Habilitar Horario 1:</label>
        <input type="checkbox" id="checkboxh1" name="checkboxh1" onchange="toggleHorario('ih1','fh1','checkboxh1')"><br>

        <label>Encendido:</label>
        <input type="time" id="ih1" name="ih1" value="00:00">
        <br>

        <label>Apagado:</label>
        <input type="time" id="fh1" name="fh1" value="00:00"><br>

        <label>Habilitar Horario 2:</label>
        <input type="checkbox" id="checkboxh2" name="checkboxh2" onchange="toggleHorario('ih2','fh2','checkboxh2')"><br>

        <label>Encendido:</label>
        <input type="time" id="ih2" name="ih2" value="00:00">
        <br>

        <label>Apagado:</label>
        <input type="time" id="fh2" name="fh2" value="00:00"><br>

        <label>Habilitar Horario 3:</label>
        <input type="checkbox" id="checkboxh3" name="checkboxh3" onchange="toggleHorario('ih3','fh3','checkboxh3')"><br>

        <label>Encendido:</label>
        <input type="time" id="ih3" name="ih3" value="00:00">
        <br>

        <label>Apagado:</label>
        <input type="time" id="fh3" name="fh3" value="00:00"><br>

        <label>Habilitar Horario 4:</label>
        <input type="checkbox" id="checkboxh4" name="checkboxh4" onchange="toggleHorario('ih4','fh4','checkboxh4')"><br>

        <label>Encendido:</label>
        <input type="time" id="ih4" name="ih4" value="00:00">
        <br>

        <label>Apagado:</label>
        <input type="time" id="fh4" name="fh4" value="00:00"><br>

        <input type="submit" value="Actualizar">

    </form>
    <h2>Vegetacion/Floracion</h2>
    <form action="/vegeflor" method="post">

        <label>Modo:</label>
        <select id="modo_vegeflor" name="modo_vegeflor">
            <option value="VEGE" selected>VEGETATIVO</option>
            <option value="FLORA">FLORACION</option>
        </select><br>

        <input type="submit" value="Actualizar">

    </form>
    <br>
    <button onclick="window.location.href ='/index'">
        Volver a inicio
    </button>
    <script>
        function loadPWM() {
            //document.getElementById("modos_pwm").value = "OFF";
            fetch("/data_pwm").then(res => {
                if (!res.ok)
                    console.error("Error en adquirir los datos del pwm")
                return res.json()
            }).then(data => {
                console.log(data)
                document.getElementById("rangoValor").textContent = data.intensidad;
                document.getElementById("rango").value = data.intensidad;
                document.getElementById("modos_pwm").value = data.Modo;
                document.getElementById("ih_pwm").value = data.ih1h + ":" + data.ih1m;
                document.getElementById("fh_pwm").value = data.fh1h + ":" + data.fh1m;
                document.getElementById("opciones").value = data.DIA;
            })
        }

        function loadTriac() {
            document.getElementById("modos_triac").value = "Apagado";
            //document.getElementById("checkboxh1").checked = true;
            fetch("/data_triac").then(res => {
                if (!res.ok)
                    console.error("Error en adquirir los datos del triac")
                return res.json()
            }).then(data => {
                console.log(data)
                document.getElementById("modos_triac").value = data.Modo;
                document.getElementById("checkboxh1").checked = data.cb1;
                document.getElementById("checkboxh2").checked = data.cb2;
                document.getElementById("checkboxh3").checked = data.cb3;
                document.getElementById("checkboxh4").checked = data.cb4;
                document.getElementById("ih1").value = data.ih1h + ":" + data.ih1m;
                document.getElementById("fh1").value = data.fh1h + ":" + data.fh1m;
                document.getElementById("ih2").value = data.ih2h + ":" + data.ih2m;
                document.getElementById("fh2").value = data.fh2h + ":" + data.fh2m;
                document.getElementById("ih3").value = data.ih3h + ":" + data.ih3m;
                document.getElementById("fh3").value = data.fh3h + ":" + data.fh3m;
                document.getElementById("ih4").value = data.ih4h + ":" + data.ih4m;
                document.getElementById("fh4").value = data.fh4h + ":" + data.fh4m;
            })

        }

        function loadVegeflor() {
            //document.getElementById("modo_vegeflor").value = "FLORA"
            fetch("/data_vegeflor").then(res => {
                if (!res.ok)
                    console.error("Error en adquirir los datos de vegeflor")
                return res.json()
            }).then(data => {
                console.log(data)
                document.getElementById("modo_vegeflor").value = data.Modo;
            })
        }

        function loadHora() {
            // document.getElementById("hora").value = 17/*data.Hora_h*/ + ":" + 25/*data.Hora_m*/;
            fetch("/data_hora").then(res => {
                if (!res.ok)
                    console.error("Error en adquirir los datos de la hora")
                return res.json()
            }).then(data => {
                console.log(data)
                document.getElementById("hora").value = data.Hora_h + ":" + data.Hora_m;
            })
        }

        function loadRed() {
            //document.getElementById("ID").textContent = "testid";
            //document.getElementById("PASS").textContent = "testpass";
            fetch("/data_red").then(res => {
                if (!res.ok)
                    console.error("Error en adquirir los datos de red")
                return res.json()
            }).then(data => {
                console.log(data);
                document.getElementById("ID").textContent = data.ID;
                document.getElementById("PASS").textContent = data.PASS;

            })
        }

        function loadValues() {
            loadPWM();
            loadTriac();
            loadVegeflor();
            loadHora();
            loadRed();
        }

        function DeshabilitarRango() {
            var opcionSeleccionada = document.getElementById("modos_pwm").value;
            var rango = document.getElementById("rango");

            if (opcionSeleccionada === "Automatico") {
                rango.disabled = false; // Deshabilitar el control de rango
            } else {
                rango.disabled = true; // Habilitar el control de rango
            }
        }

        function habilitarHorario() {
            var selectElement = document.getElementById("modos_pwm");
            var selectedValue = selectElement.value;
            const horarioInput_i = document.getElementById("ih_pwm");
            const horarioInput_f = document.getElementById("fh_pwm");

            // Ejecutar una función específica para cada opción
            if (selectedValue == "Automatico") {

                horarioInput_i.disabled = false;
                horarioInput_f.disabled = false;
            }
            else {
                horarioInput_i.disabled = true;
                horarioInput_f.disabled = true;

            }
        }

        function statusCheckboxs() {
            var selectElement = document.getElementById("modos_triac");
            var selectedValue = selectElement.value;
            const c1 = document.getElementById("checkboxh1");
            const c2 = document.getElementById("checkboxh2");
            const c3 = document.getElementById("checkboxh3");
            const c4 = document.getElementById("checkboxh4");

            // Ejecutar una función específica para cada opción
            if (selectedValue == "Automatico") {

                c1.disabled = false;
                c2.disabled = false;
                c3.disabled = false;
                c4.disabled = false;
            }
            else {
                c1.disabled = true;
                c2.disabled = true;
                c3.disabled = true;
                c4.disabled = true;

            }
        }

        function toggleHorario(InicioID, FinID, HorarioID) {
            const horarioInput_i = document.getElementById(InicioID);
            const horarioInput_f = document.getElementById(FinID);
            const checkbox = document.getElementById(HorarioID);

            if (checkbox.checked && document.getElementById("modos_triac").value == "Automatico") {
                horarioInput_i.disabled = false;
                horarioInput_f.disabled = false;
            } else {
                horarioInput_i.disabled = true;
                horarioInput_f.disabled = true;
            }
        }

        function updateRangoValue() {
            const rangoInput = document.getElementById('rango');
            const rangoValueSpan = document.getElementById('rangoValor');

            rangoValueSpan.textContent = rangoInput.value;
        }

        function config_pwm() {
            habilitarHorario();
        }

        function config_triac() {
            statusCheckboxs();
            toggleHorario('ih1', 'fh1', 'checkboxh1');
            toggleHorario('ih2', 'fh2', 'checkboxh2');
            toggleHorario('ih3', 'fh3', 'checkboxh3');
            toggleHorario('ih4', 'fh4', 'checkboxh4');
        }

        document.addEventListener("DOMContentLoaded", function () {
            loadValues();
            config_pwm();
            config_triac();

        });

    </script>
</body>

</html>